# Manual T√©cnico - BarberShop

Este documento detalla la arquitectura t√©cnica, correcciones cr√≠ticas y funcionalidades del sistema BarberShop.

## üõ† Arquitectura
- **Backend**: Spring Boot 3.x, JPA, Spring Security, JWT.
- **Frontend**: Angular 17+ (Componentes Standalone).
- **Base de Datos**: H2 (Desarrollo) / PostgreSQL (Producci√≥n).

## üêû Registro de Bugs y Soluciones Cr√≠ticas

### 1. Error 404 en Conversi√≥n de Leads (Enero 2026)
- **Problema**: Al intentar convertir un Lead a Cliente desde el Dashboard de CRM, el sistema devolv√≠a un `404 Not Found` a pesar de que el controlador exist√≠a.
- **Causa**: Conflictos de mapeo en el `CRMController` que imped√≠an que Spring registrara correctamente las rutas din√°micas bajo `/api/crm`.
- **Soluci√≥n**: Se consolidaron los endpoints administrativos del CRM dentro del `AdminController` (bajo la ruta `/api/admin/crm`). Al ser un controlador ya validado y con permisos robustos, las rutas se estabilizaron inmediatamente.
- **Estado**: ‚úÖ Resuelto.

### 2. Modal de Usuario no se cerraba tras Guardar (Enero 2026)
- **Problema**: En el Directorio de Clientes, al crear un nuevo usuario y presionar "Guardar", los datos se enviaban correctamente pero el modal permanec√≠a abierto, confundiendo al usuario.
- **Causa**: Problema de **Change Detection** en Angular. Al ejecutarse dentro de un Observable as√≠ncrono (`HttpClient.post`), Angular no siempre detectaba el cambio de estado de la variable `showUserModal` de forma inmediata.
- **Soluci√≥n**: Se implement√≥ una llamada expl√≠cita a `ChangeDetectorRef.detectChanges()` justo despu√©s de cerrar el modal en el bloque `next` de la suscripci√≥n. Esto garantiza que la UI se actualice en el mismo ciclo de ejecuci√≥n del navegador.
- **Estado**: ‚úÖ Resuelto.

### 3. Sincronizaci√≥n de Disponibilidad de Barberos
- **Funcionalidad**: Se a√±adi√≥ un sistema de "Estado" (Activo/Inactivo) para el personal.
- **L√≥gica**: Cuando un barbero se marca como "Inactivo", el backend filtra su perfil en la lista de disponibilidad de citas.
- **Componentes**: `BarberController` (Backend), `AdminService` y `AdminComponent` (Frontend).

---

## üìÖ Roadmap Pr√≥ximas Implementaciones

### Dossier de Clientes
- **Objetivo**: Ficha t√©cnica individual para cada cliente.
- **Detalle**: Historial de cortes, fotos de referencia del cliente, productos comprados y notas del barbero (ej: "prefiere tijera sobre m√°quina").

### Dashboard de Reportes
- **Objetivo**: M√©tricas de negocio para la toma de decisiones.
- **Detalle**: Ingresos por servicio, ocupaci√≥n por barbero y tasa de retorno de clientes.

## ‚òÅÔ∏è Gu√≠a de Despliegue - Oracle Cloud (Free Tier)

### Hardware Recommendations
- **Shape:** `VM.Standard.E2.1.Micro` (AMD) -> **SOLO PARA 1 APP** (1 GB RAM).
- **Shape Recomendado (Multi-Apps):** `VM.Standard.A1.Flex` (Ampere ARM) -> **Soporta 7+ Apps** (24 GB RAM, 4 OCPUs).
- **Image:** Canonical Ubuntu 20.04 or 22.04 Minimal.
- **SSH Key:** Generar par de llaves (`ssh-keygen`) o usar existentes. Guardar la `.key` (privada) y subir la `.pub` (p√∫blica).

### 1. Creaci√≥n de Instancia (Compute Instance)
- **Shape**: `VM.Standard.A1.Flex` (ARM, hasta 4 OCPUs y 24GB RAM - Siempre Gratis) o `VM.Standard.E2.1.Micro` (x86, m√°s limitado).
- **Imagen**: Oracle Linux 8/9 o Ubuntu 22.04 LTS.
- **SSH Keys**: Es cr√≠tico generar y bajar el par de claves (Private/Public Key) al crear la instancia. Sin la `.key` (privada) no se podr√° acceder.

### 2. Configuraci√≥n de Red (VCN)
- **VCN y Subnet**: Se crea una VCN con una Subnet p√∫blica para que la instancia tenga IP accesible desde internet.
- **Security List (Firewall)**: Se deben a√±adir "Ingress Rules" para permitir el tr√°fico:
    - **Puerto 22**: SSH (Acceso remoto).
    - **Puerto 80**: HTTP.
    - **Puerto 443**: HTTPS.
    - **Puerto 8080**: (Opcional) Si se despliega Spring Boot directamente sin proxy inverso inicialmente.

### 3. Conexi√≥n SSH
Para conectarse a la instancia desde la terminal local:
1.  Navegar a la carpeta donde est√° la llave: `cd /ruta/a/la/llave`
2.  Dar permisos correctos 