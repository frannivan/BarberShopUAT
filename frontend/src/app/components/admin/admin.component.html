<div class="admin-container animate-fade-in">
    <div class="header-section mb-4">
        <div class="d-flex justify-content-between align-items-end">
            <div>
                <h1 class="page-title-lux mb-1">Admin Dashboard</h1>
                <p class="text-subtitle">Gestión centralizada de citas, personal y clientes</p>
            </div>
            <div class="stats-container-premium">
                <div class="stats-badge-premium">
                    <span class="count">{{ stats.users }}</span>
                    <span class="label">Usuarios</span>
                </div>
                <div class="stats-badge-premium">
                    <span class="count">{{ todayAppointmentsCount }}</span>
                    <span class="label">Citas Hoy</span>
                </div>
                <div class="stats-badge-premium">
                    <span class="count">{{ activeBarbersCount }}</span>
                    <span class="label">Barberos Activos</span>
                </div>
            </div>
        </div>
    </div>

    <mat-tab-group (selectedTabChange)="onTabChange($event)">
        <!-- Appointments Tab -->
        <mat-tab label="Citas">
            <div class="tab-content">
                <div class="p-4 border-bottom" style="border-color: rgba(255,255,255,0.05) !important;">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h2 class="section-title mb-0">Gestión de Citas</h2>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="search-box-lux mx-auto" style="width: 100%; max-width: 350px;">
                                <mat-form-field appearance="outline" class="premium-search status-select">
                                    <mat-label>Buscar Cita</mat-label>
                                    <input matInput [(ngModel)]="aptSearchTerm" placeholder="Cliente o Barbero">
                                    <mat-icon matSuffix>search</mat-icon>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 text-end" style="text-align: right;">
                            <button class="btn-action-lux" style="background: var(--gradient-red); padding: 10px 20px;"
                                (click)="navigateToBooking()">
                                <i class="fas fa-calendar-plus mr-2"></i> Nueva Cita
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card-glass-premium shadow-lg">
                    <div class="table-responsive">
                        <table class="table mb-0 premium-crm-table">
                            <thead>
                                <tr>
                                    <th class="col-datetime">FECHA Y HORA</th>
                                    <th class="col-apt-client">CLIENTE</th>
                                    <th class="col-barber">BARBERO</th>
                                    <th class="col-status">ESTADO</th>
                                    <th class="col-apt-actions text-right">ACCIONES</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let appointment of filteredAppointments" class="premium-row"
                                    (click)="openEditAppointmentModal(appointment)" style="cursor: pointer;">
                                    <td>
                                        <div class="user-icon-lux"><i class="fas fa-calendar-check"></i></div>
                                        <div class="item-main-text">{{ appointment.startTime | date:'medium' }}</div>
                                    </td>
                                    <td>
                                        <div class="item-main-text">{{ appointment.user?.name || appointment.guestName
                                            }}</div>
                                        <small class="item-sub-text">{{ appointment.user?.email || 'Guest' }}</small>
                                    </td>
                                    <td><span class="role-badge">{{ appointment.barber?.name }}</span></td>
                                    <td>
                                        <span class="status-indicator-premium" [ngClass]="appointment.status">
                                            {{ appointment.status }}
                                        </span>
                                    </td>
                                    <td class="text-right">
                                        <button class="btn-action-lux warn"
                                            (click)="$event.stopPropagation(); cancelAppointment(appointment.id)"
                                            title="Cancelar Cita">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr *ngIf="appointments.length === 0">
                                    <td colspan="5" class="text-center py-5">
                                        <div class="empty-state-premium">
                                            <i class="fas fa-calendar-times mb-3"></i>
                                            <p>No hay citas registradas.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </mat-tab>

        <!-- Personal Management Tab -->
        <mat-tab label="Personal">
            <div class="tab-content" style="position: relative;">
                <div class="p-4 border-bottom" style="border-color: rgba(255,255,255,0.05) !important;">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <h2 class="section-title mb-0">Directorio de Personal</h2>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="search-box-lux mx-auto" style="width: 100%; max-width: 350px;">
                                <mat-form-field appearance="outline" class="premium-search status-select">
                                    <mat-label>Filtrar por Rol</mat-label>
                                    <mat-select [(ngModel)]="selectedRoleFilter">
                                        <mat-option value="ALL">Todos</mat-option>
                                        <mat-option *ngFor="let role of staffRoles" [value]="role">{{ role
                                            }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-md-4 text-end" style="text-align: right;">
                            <button class="btn-action-lux" style="background: var(--gradient-red); padding: 10px 20px;"
                                (click)="openUserModal()">
                                <i class="fas fa-user-plus mr-2"></i> Nuevo Personal
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card-glass-premium shadow-lg">
                    <div class="table-responsive">
                        <table class="table mb-0 premium-crm-table">
                            <thead>
                                <tr>
                                    <th class="col-user">USUARIO</th>
                                    <th class="col-email">EMAIL</th>
                                    <th class="col-phone">TELÉFONO</th>
                                    <th class="col-role">ROL</th>
                                    <th class="col-status">ESTADO</th>
                                    <th class="col-actions-sm">ACCIONES</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let user of staffMembers" class="premium-row">
                                    <td>
                                        <div class="user-icon-lux">
                                            <i class="fas"
                                                [ngClass]="user.role === 'BARBER' ? 'fa-cut' : (user.role === 'ADMIN' ? 'fa-user-shield' : 'fa-user')"></i>
                                        </div>
                                        <div class="item-main-text">{{ user.name }}</div>
                                    </td>

                                    <td>
                                        <div class="item-sub-text">{{ user.email }}</div>
                                    </td>
                                    <td>
                                        <div class="item-sub-text">{{ user.phone || '-' }}</div>
                                    </td>
                                    <td><span class="role-badge">{{ user.role }}</span></td>
                                    <td class="center">
                                        <!-- Dynamic Neon Switch for ALL users -->
                                        <!-- Simple Status Indicator -->
                                        <div class="d-flex align-items-center">
                                            <span class="status-indicator-premium"
                                                [ngClass]="isBarberActive(user) ? 'NEW' : 'DISCARDED'">
                                                {{ isBarberActive(user) ? 'Activo' : 'Inactivo' }}
                                            </span>
                                        </div>


                                    <td>
                                        <div class="d-flex justify-content-start gap-2">
                                            <button class="btn-action-lux btn-toggle mr-2" *ngIf="isBarber(user)"
                                                [ngClass]="isBarberActive(user) ? 'active' : 'inactive'"
                                                (click)="toggleBarberStatus(user)"
                                                [title]="isBarberActive(user) ? 'Desactivar Barbero' : 'Activar Barbero'">
                                                <i class="fas"
                                                    [ngClass]="isBarberActive(user) ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                                            </button>

                                            <button class="btn-action-lux mr-2" (click)="startEditUser(user)"
                                                title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn-action-lux warn" (click)="deleteUser(user.id)"
                                                title="Eliminar">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="staffMembers.length === 0">
                                    <td colspan="5" class="text-center py-5">
                                        <div class="empty-state-premium">
                                            <i class="fas fa-users-slash mb-3"></i>
                                            <p>No hay personal registrado.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </mat-tab>
        <!-- Client History (CRM) Tab -->
        <mat-tab label="Clientes">
            <div class="tab-content" style="position: relative;">
                <div class="row justify-content-center">
                    <div class="col-md-11">
                        <div class="card-glass-premium shadow-lg animate-fade-in">
                            <div class="p-4 border-bottom" style="border-color: rgba(255,255,255,0.05) !important;">
                                <div class="row align-items-center">
                                    <div class="col-md-4">
                                        <h2 class="section-title mb-0">Directorio de Clientes</h2>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <div class="search-box-lux mx-auto" style="width: 100%; max-width: 350px;">
                                            <mat-form-field appearance="outline" class="premium-search status-select">
                                                <mat-label>Buscar Cliente</mat-label>
                                                <input matInput [(ngModel)]="crmSearchTerm"
                                                    placeholder="Nombre o Email">
                                                <mat-icon matSuffix>search</mat-icon>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end" style="text-align: right;">
                                        <button class="btn-action-lux"
                                            style="background: var(--gradient-red); padding: 10px 20px;"
                                            (click)="openCreateClientModal()">
                                            <i class="fas fa-plus mr-1"></i> Nuevo Cliente
                                        </button>
                                    </div>
                                </div>
                            </div>




                            <div class="table-scroll-container">
                                <table class="table mb-0 premium-crm-table">
                                    <thead>
                                        <tr>
                                            <th class="col-client">CLIENTE</th>
                                            <th class="col-contact">CONTACTO</th>
                                            <th class="col-phone-crm">TELÉFONO</th>
                                            <th class="col-actions text-right">ACCIONES</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let client of uniqueClients; trackBy: trackByClient"
                                            class="premium-row">
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="user-icon-lux">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                    <div class="item-main-text">{{ client.name }}</div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="item-sub-text">{{ client.email }}</div>
                                            </td>
                                            <td>
                                                <div class="item-sub-text">{{ client.phone || '-' }}</div>
                                            </td>
                                            <td class="text-right">
                                                <button type="button" class="btn-action-lux"
                                                    (click)="$event.stopPropagation(); viewClientHistory(client)"
                                                    title="Ver Historial">
                                                    <i class="fas fa-eye mr-2"></i> Ver Detalle
                                                </button>
                                            </td>
                                        </tr>
                                        <tr *ngIf="uniqueClients.length === 0">
                                            <td colspan="4" class="text-center py-5">
                                                <div class="empty-state-premium">
                                                    <i class="fas fa-search mb-3"></i>
                                                    <p>No se encontraron clientes.</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </mat-tab>
    </mat-tab-group>

    <!-- Appointment Edit Modal Overlay (Unified Lux) -->
    <div class="modal-overlay-lux" *ngIf="showAppointmentModal" (click)="closeAppointmentModal()">

        <mat-card class="modal-card-lux medium" (click)="$event.stopPropagation()">

            <button class="close-btn-sexy" (click)="closeAppointmentModal()">
                <mat-icon>close</mat-icon>
            </button>

            <div class="modal-header-lux mb-4 border-bottom border-secondary pb-3 mt-2"
                style="margin-bottom: 3rem !important;">
                <div class="d-flex align-items-center justify-content-center w-100">
                    <div class="user-avatar-lux mr-3" style="background: var(--gradient-gold); color: black;">
                        <mat-icon>edit_calendar</mat-icon>
                    </div>
                    <div class="text-center">
                        <h3 class="mb-0">Editar Cita</h3>
                        <p class="text-gray mb-0 small">Gestionar detalles de la reserva</p>
                    </div>
                </div>
            </div>

            <mat-card-content>
                <div class="booking-wrapper" style="display: flex; flex-direction: column; gap: 16px;">
                    <!-- TOP GRID: 2 COLUMNS -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; width: 100%;">
                        <!-- LEFT CARD: PROFESSIONAL & SERVICE -->
                        <div class="booking-card"
                            style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                            <h6 class="text-gray uppercase text-xs font-weight-bold mb-3 d-flex align-items-center"
                                style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                                <mat-icon class="text-gold mr-2"
                                    style="font-size: 16px; width: 16px; height: 16px;">work</mat-icon>
                                Profesional y Servicio
                            </h6>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-3">
                                <mat-label>Barbero</mat-label>
                                <mat-select [(ngModel)]="editBarberId">
                                    <mat-option *ngFor="let b of activeBarbers" [value]="b.id">{{ b.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                <mat-label>Servicio</mat-label>
                                <mat-select [(ngModel)]="editTypeId">
                                    <mat-option *ngFor="let t of serviceTypes" [value]="t.id">{{ t.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- RIGHT CARD: TIMING -->
                        <div class="booking-card"
                            style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                            <h6 class="text-gray uppercase text-xs font-weight-bold mb-4 d-flex align-items-center"
                                style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                                <mat-icon class="text-gold mr-2"
                                    style="font-size: 16px; width: 16px; height: 16px;">event</mat-icon>
                                Fecha y Hora
                            </h6>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-3">
                                <mat-label>Fecha</mat-label>
                                <input matInput [matDatepicker]="editDistPicker" [(ngModel)]="editDate">
                                <mat-datepicker-toggle matSuffix [for]="editDistPicker"
                                    class="text-accent"></mat-datepicker-toggle>
                                <mat-datepicker #editDistPicker></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-3">
                                <mat-label>Inicio</mat-label>
                                <input matInput type="time" [(ngModel)]="editTime">
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                <mat-label>Fin</mat-label>
                                <input matInput type="time" [(ngModel)]="editEndTime">
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- GUEST INFO (Conditional) -->
                    <div class="booking-card" *ngIf="editGuestName || editGuestEmail"
                        style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                        <h6 class="text-gray uppercase text-xs font-weight-bold mb-3 d-flex align-items-center"
                            style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                            <mat-icon class="text-gold mr-2"
                                style="font-size: 16px; width: 16px; height: 16px;">person_outline</mat-icon>
                            Datos del Invitado
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                    <mat-label>Nombre</mat-label>
                                    <input matInput [(ngModel)]="editGuestName">
                                    <mat-icon matSuffix class="text-gray">person</mat-icon>
                                </mat-form-field>
                            </div>
                            <div class="col-md-6 mb-2">
                                <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                    <mat-label>Email</mat-label>
                                    <input matInput [(ngModel)]="editGuestEmail">
                                    <mat-icon matSuffix class="text-gray">email</mat-icon>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>

                    <!-- BOTTOM CARD: STATUS & NOTES -->
                    <div class="booking-card"
                        style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                        <div class="d-flex justify-content-between align-items-center mb-2"
                            style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                            <h6 class="text-gray uppercase text-xs font-weight-bold mb-0 d-flex align-items-center">
                                <mat-icon class="text-gold mr-2"
                                    style="font-size: 16px; width: 16px; height: 16px;">content_paste</mat-icon>
                                Estatus y Notas
                            </h6>
                        </div>

                        <mat-form-field appearance="outline" class="w-100 premium-search-compact mt-2 mb-2">
                            <mat-label>Estatus de la Cita</mat-label>
                            <mat-select [(ngModel)]="editStatus">
                                <mat-option value="CONFIRMED" class="text-success">Confirmada</mat-option>
                                <mat-option value="PENDING" class="text-warning">Pendiente</mat-option>
                                <mat-option value="COMPLETED" class="text-info">Completada</mat-option>
                                <mat-option value="CANCELLED" class="text-danger">Cancelada</mat-option>
                                <mat-option value="NOSHOW" class="text-muted">No Asistió</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                            <mat-label>Notas Internas</mat-label>
                            <textarea matInput [(ngModel)]="editNotes" rows="3"
                                placeholder="Detalles adicionales..."></textarea>
                        </mat-form-field>
                    </div>

                </div>
            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-raised-button color="primary" class="brand-accent-pill px-4"
                    (click)="saveAppointmentChanges()">
                    Guardar Cambios
                </button>
            </mat-card-actions>

        </mat-card>
    </div>
    <!-- User Modal Overlay -->
    <!-- Moved outside the tab group to ensure it works from any tab -->
    <!-- User Modal Overlay (Unified Lux) -->
    <div class="modal-overlay-lux" *ngIf="showUserModal" (click)="closeUserModal()">

        <mat-card class="modal-card-lux medium" (click)="$event.stopPropagation()">

            <button class="close-btn-sexy" (click)="closeUserModal()">
                <mat-icon>close</mat-icon>
            </button>

            <div class="modal-header-lux pb-2 mt-2 border-bottom border-secondary"
                style="margin-bottom: 3rem !important;">
                <div class="d-flex align-items-center justify-content-center w-100">
                    <div class="user-avatar-lux mr-3" style="background: var(--gradient-red); color: white;">
                        <i class="fas" [ngClass]="isEditingUser ? 'fa-user-edit' : 'fa-user-plus'"></i>
                    </div>
                    <div class="text-center">
                        <h3 class="mb-0">{{ isEditingUser ? 'Editar Perfil' : (modalContext === 'client' ? 'Nuevo
                            Cliente' : 'Nuevo Empleado') }}</h3>
                        <p class="text-gray mb-0 small">{{ modalContext === 'client' ? 'Gestión de Clientes' : 'Gestión
                            de Personal' }}</p>
                    </div>
                </div>
            </div>

            <mat-card-content>
                <div class="booking-wrapper" style="display: flex; flex-direction: column; gap: 16px;">

                    <!-- TOP SECTION: 2-COLUMN GRID -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; width: 100%;">

                        <!-- LEFT CARD: BASIC INFO -->
                        <div class="booking-card"
                            style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                            <h6 class="text-gray uppercase text-xs font-weight-bold mb-3 d-flex align-items-center"
                                style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                                <mat-icon class="text-gold mr-2"
                                    style="font-size: 16px; width: 16px; height: 16px;">badge</mat-icon>
                                Información Básica
                            </h6>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-2">
                                <mat-label>Nombre Completo</mat-label>
                                <input matInput [(ngModel)]="newUser.name" required>
                                <mat-icon matSuffix class="text-gray">badge</mat-icon>
                            </mat-form-field>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-2">
                                <mat-label>Email</mat-label>
                                <input matInput [(ngModel)]="newUser.email" required email>
                                <mat-icon matSuffix class="text-gray">email</mat-icon>
                            </mat-form-field>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                <mat-label>Teléfono</mat-label>
                                <input matInput [(ngModel)]="newUser.phone">
                                <mat-icon matSuffix class="text-gray">phone</mat-icon>
                            </mat-form-field>
                        </div>

                        <!-- RIGHT CARD: SECURITY & ROLE -->
                        <div class="booking-card"
                            style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                            <h6 class="text-gray uppercase text-xs font-weight-bold mb-4 d-flex align-items-center"
                                style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                                <mat-icon class="text-gold mr-2"
                                    style="font-size: 16px; width: 16px; height: 16px;">security</mat-icon>
                                Seguridad y Rol
                            </h6>
                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-3">
                                <mat-label>Contraseña</mat-label>
                                <input matInput [(ngModel)]="newUser.password" type="password"
                                    [required]="!isEditingUser">
                                <mat-icon matSuffix class="text-gray">lock</mat-icon>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="w-100 premium-search-compact mb-3">
                                <mat-label>Género</mat-label>
                                <mat-select [(ngModel)]="newUser.gender">
                                    <mat-option value="Male">Masculino</mat-option>
                                    <mat-option value="Female">Femenino</mat-option>
                                    <mat-option value="Other">Otro</mat-option>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="w-100 premium-search-compact">
                                <mat-label>Rol</mat-label>
                                <mat-select [(ngModel)]="newUser.role" required
                                    [disabled]="!isEditingUser && availableRoles.length === 1">
                                    <mat-option *ngFor="let r of availableRoles" [value]="r">{{ r }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- BARBER SPECIFIC CONFIG (Conditional) -->
                    <div *ngIf="newUser.role === 'BARBER' || newUser.role === 'ADMIN_BARBER'"
                        class="booking-card animate-fade-in"
                        style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                        <h6 class="text-gray uppercase text-xs font-weight-bold mb-3 d-flex align-items-center"
                            style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                            <mat-icon class="text-gold mr-2"
                                style="font-size: 16px; width: 16px; height: 16px;">content_cut</mat-icon>
                            Configuración de Barbero
                        </h6>
                        <div style="display: flex; flex-direction: column; gap: 24px;">
                            <!-- Photo Upload Section -->
                            <div class="w-100">
                                <mat-form-field appearance="outline" class="w-100 premium-search-compact"
                                    style="display:none">
                                    <mat-label>URL de Foto</mat-label>
                                    <input matInput [(ngModel)]="newUser.photoUrl">
                                </mat-form-field>

                                <div class="d-flex align-items-center justify-content-between p-3"
                                    style="background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px dashed rgba(255,255,255,0.2);">
                                    <span class="text-gray text-sm">Foto de Perfil</span>
                                    <div class="d-flex align-items-center">
                                        <button mat-stroked-button type="button" (click)="fileInput.click()"
                                            class="mr-3 text-white border-white small-btn">
                                            <mat-icon>cloud_upload</mat-icon> Subir
                                        </button>
                                        <input #fileInput type="file" (change)="onFileSelected($event)"
                                            accept=".png, .jpg, .jpeg" style="display:none">

                                        <img *ngIf="newUser.photoUrl" [src]="newUser.photoUrl"
                                            class="rounded-circle border border-white"
                                            style="width: 48px; height: 48px; object-fit: cover;">
                                        <div *ngIf="!newUser.photoUrl"
                                            class="rounded-circle border border-secondary d-flex align-items-center justify-content-center text-gray"
                                            style="width: 48px; height: 48px; background: rgba(0,0,0,0.3);">
                                            <mat-icon>person</mat-icon>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Color Picker Section -->
                            <div class="w-100">
                                <div class="d-flex align-items-center justify-content-between p-3"
                                    style="background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                                    <label class="text-gray text-sm mb-0">Color Identificador</label>
                                    <div class="d-flex align-items-center">
                                        <span class="mr-3 text-xs text-muted">{{ newUser.color }}</span>
                                        <input type="color" [(ngModel)]="newUser.color" class="color-picker-lux"
                                            style="width: 60px; height: 40px; border: none; padding: 0; background: none;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-raised-button color="primary" class="brand-accent-pill px-4" (click)="saveUserForm()">
                    {{ isEditingUser ? 'Guardar Cambios' : 'Crear Usuario' }}
                </button>
            </mat-card-actions>
        </mat-card>
    </div>